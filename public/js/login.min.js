"use strict";var generateRoomName=function(){return chance.word()+"-"+chance.hash().substring(0,8)},toRtcRoomName=function(e){return e.replace(/[^\w\s]/gi,"").replace(/ /gi,"_")},Query={getRoomName:function(){var e="?room=",r=document.location.search;return r.length<=e.length?null:0!==r.indexOf(e)?(ErrorMetric.log("Query.getRoomName => Invalid querystring: "+r),null):unescape(r.substring(6))}},StorageCookie={_validate:function(e){return"string"==typeof e.userName&&"boolean"==typeof e.cameraIsEnabled&&"boolean"==typeof e.micIsEnabled&&"boolean"==typeof e.dashModeEnabled},set:function(e){return this._validate(e)?(localStorage.tubertc=JSON.stringify(e),!0):(ErrorMetric.log("StorageCookie.set => invalid Object structure"),ErrorMetric.log("                  => "+JSON.stringify(e)),!1)},setValue:function(e,r){var o=this.get();return null===o?(ErrorMetric.log("StorageCookie.setValue => StorageCookie.get had invalid return value"),!1):void 0!==o[e]?(ErrorMetric.log('StorageCookie.setValue => invalid key "'+e+'"'),!1):(o[e]=r,this.set(o))},get:function(){var e=localStorage.tubertc;if(void 0===e)return ErrorMetric.log("StorageCookie.get => localStorage.tubertc does not exist"),null;try{var r=JSON.parse(e);return this._validate(r)?r:(ErrorMetric.log("StorageCookie.get => localStorage.tubertc Object is invalid"),ErrorMetric.log("                  => "+JSON.stringify(r)),null)}catch(e){return ErrorMetric.log("StorageCookie.get => exception while trying to validate localStorage.tubertc"),ErrorMetric.log("                  => "+e),null}},getValue:function(e){var r=this.get();return null!==r?void 0===r[e]?(ErrorMetric.log('StorageCookie.getKey => invalid key "'+e+'"'),null):r[e]:(ErrorMetric.log("StorageCookie.getKey => StorageCookie.get had invalid return value"),null)}},_joinBtn=$("#joinBtn"),_loginMsg=$("#loginMsg"),_loginAlert=$("#loginAlert"),_userNameEntry=$("#userNameEntry"),_roomNameEntry=$("#roomNameEntry"),Login={_completionFn:null,_checkIfNonTlsAndChromeAbove47:function(){var e=navigator.userAgent;if("https:"!==window.location.protocol&&"localhost"!==window.location.hostname&&"127.0.0.1"!==window.location.hostname){var r=null,o=e.indexOf("Chrome/");if(-1===o&&(o=e.indexOf("Chromium/")),-1===o)return!0;var t=e.indexOf(" ",o);if((-1!==(r=(-1===t?e.substring(o):e.substring(o,t)).split("/")[1]).indexOf(".")?parseInt(r.split(".")[0],10):parseInt(r,10))>=47)return!0}return!1},_browserCompatCheck:function(){var e=navigator.userAgent;return"Notification"in window?"localStorage"in window?VTCCore.isBrowserSupported()?"chrome"in window?Login._checkIfNonTlsAndChromeAbove47()?"ssl":"full":"untested":(ErrorMetric.log("_browserCompatCheck => browser does not support WebRTC"),ErrorMetric.log("                    => userAgent: "+e),null):(ErrorMetric.log("_browserCompatCheck => browser does not support LocalStorage"),ErrorMetric.log("                    => userAgent: "+e),null):(ErrorMetric.log("_browserCompatCheck => browser does not support Notifications"),ErrorMetric.log("                    => userAgent: "+e),null)},_validate:function(){var e=$.trim(_userNameEntry.val()),r=$.trim(_roomNameEntry.val());return 0===e.length?(_loginAlert.html("Please provide a <b>user name</b>.").stop(!0,!1).slideDown(),_userNameEntry.focus(),!1):0!==r.length||(_loginAlert.html("Please provide a <b>room name</b>.").stop(!0,!1).slideDown(),_roomNameEntry.focus(),!1)},initialize:function(e){var r=this;if("object"!=typeof e.cameraBtn||"object"!=typeof e.micBtn||"object"!=typeof e.dashBtn)return ErrorMetric.log("Log.initialize => config parameter is not valid"),ErrorMetric.log("               => config.cameraBtn is "+e.cameraBtn),ErrorMetric.log("               => config.micBtn is "+e.micBtn),ErrorMetric.log("               => config.dashBtn is "+e.dashBtn),null;var o=this._browserCompatCheck();if(null===o)return _userNameEntry.prop("disabled",!0),_roomNameEntry.prop("disabled",!0),_joinBtn.prop("disabled",!0),_loginAlert.html('Your browser <b>does not</b> support some of the required APIs.<br>tubertc will not work on your current system.<br><br>We recommend using <a href="http://www.google.com/chrome/">Google Chrome</a>.').slideDown(),e.cameraBtn.disableButton(),e.micBtn.disableButton(),e.dashBtn.disableButton(),ErrorMetric.log("Login.initialize => "+navigator.userAgent+" is not supported"),null;"untested"===o?(_loginAlert.html('Your browser configuration has not been extensively tested. There may be user interface artifacts or missing functionality.<br><br>We recommend using <a href="http://www.google.com/chrome/">Google Chrome</a>.').slideDown(),ErrorMetric.log("Login.initialize => "+navigator.userAgent+" is untested")):"ssl"===o&&(_loginAlert.html("Starting with Chrome 47 and higher, WebRTC will cease to function on non-TLS sites.").slideDown(),ErrorMetric.log("Login.initialize => "+navigator.userAgent+" requires SSL for getUserMedia to work"));var t=StorageCookie.getValue("userName"),n="abcdefg9289821";null!==t&&_userNameEntry.val(t),_roomNameEntry.val(n).prop("disabled",!0);var i=StorageCookie.getValue("cameraIsEnabled"),a=StorageCookie.getValue("micIsEnabled"),l=StorageCookie.getValue("dashModeEnabled"),s=function(e,r){null!==e&&e!==r.isSelected()&&r.toggle()};return s(i,e.cameraBtn),s(a,e.micBtn),s(l,e.dashBtn),easyrtc.getVideoSourceList(function(r){0===r.length&&(s(!1,e.cameraBtn),e.cameraBtn.disableButton(),_loginMsg.html("Disabling camera functionality because a camera could not be found.").slideDown())}),_userNameEntry.keypress(function(e){13===e.which&&_joinBtn.click()}),_roomNameEntry.keypress(function(e){13===e.which&&_joinBtn.click()}),_joinBtn.click(function(){if(r._validate()){_loginAlert.stop(!0,!1).slideUp();var o={userName:_userNameEntry.val(),roomName:_roomNameEntry.val(),rtcName:toRtcRoomName(_roomNameEntry.val()),cameraIsEnabled:e.cameraBtn.isSelected(),hasCamera:e.cameraBtn.isEnabled(),micIsEnabled:e.micBtn.isSelected(),hasMic:e.micBtn.isEnabled(),dashIsEnabled:e.dashBtn.isSelected()},t={userName:o.userName,cameraIsEnabled:o.cameraIsEnabled,micIsEnabled:o.micIsEnabled,dashModeEnabled:o.dashIsEnabled};StorageCookie.set(t),null!==r._completionFn?$("#loginContent").fadeOut(function(){r._completionFn(o)}):(ErrorMetric.log("joinBtn.click => _completionFn not set"),Dialog.show("An Error Has Occurred","tubertc has broke!"))}else ErrorMetric.log("joinBtn.click => failed to validate")}),this},done:function(e){return this._completionFn=e,this}};